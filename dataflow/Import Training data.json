{
	"name": "Import Training data",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "Databricks_SQL_dbo_Pafos_training_raw",
						"type": "DatasetReference"
					},
					"name": "ImportTrainingDataset",
					"description": "Import data from Training_data_raw"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "Training_data_transformed",
						"type": "DatasetReference"
					},
					"name": "TrainingTransformed",
					"description": "Save transformed dataset to Datalake",
					"rejectedDataLinkedService": {
						"referenceName": "DLinternal",
						"type": "LinkedServiceReference"
					}
				}
			],
			"transformations": [
				{
					"name": "SelectTraningColumns",
					"description": "Keep only the Feature columns and Target Column"
				},
				{
					"name": "Alter5DHMOS",
					"description": "Change _5_DHMOS_Desc_EN Values"
				}
			],
			"scriptLines": [
				"source(output(",
				"          CustomerId as string,",
				"          Loyalty_PointBalance_Range as string,",
				"          Loyalty_Registration_Year as string,",
				"          Loyalty_Preferred_Store as string,",
				"          Customer_Random_Digit as string,",
				"          Customer_Random_Digit2 as string,",
				"          Gender as string,",
				"          AgeRange as string,",
				"          AgeRange2 as string,",
				"          HasEmail as string,",
				"          Closest_Distance_range as string,",
				"          Postcode as string,",
				"          {_4_PERIFER_ENOTHTA_Desc_EN} as string,",
				"          {_5_DHMOS_Desc_EN} as string,",
				"          Children_Held as string,",
				"          RFM as string,",
				"          R_Rank_24M as string,",
				"          F_Rank_24M as string,",
				"          M_Rank_24M as string,",
				"          Activity_History_String_8Q as string,",
				"          Activity_History_String_4S as string,",
				"          Spending_Customer_Status as string,",
				"          Activity_History_String_3M as string,",
				"          CIFs_Spending_12M as string,",
				"          CIFs_Spending_01_12M as string,",
				"          CIFs_Spending_02_12M as string,",
				"          CIFs_Spending_03_12M as string,",
				"          CIFs_Spending_04_12M as string,",
				"          CIFs_Spending_05_12M as string,",
				"          CIFs_Spending_06_12M as string,",
				"          CIFs_Spending_07_12M as string,",
				"          CIFs_Spending_08_12M as string,",
				"          CIFs_Spending_09_12M as string,",
				"          CIFs_Spending_10_12M as string,",
				"          CIFs_Spending_11_12M as string,",
				"          CIFs_Spending_12_12M as string,",
				"          CIFs_Spending_13_12M as string,",
				"          CIFs_Spending_14_12M as string,",
				"          CIFs_Spending_15_12M as string,",
				"          CIFs_Spending_16_12M as string,",
				"          CIFs_Spending_17_12M as string,",
				"          CIFs_Spending_18_12M as string,",
				"          CIFs_Spending_19_12M as string,",
				"          CIFs_Spending_20_12M as string,",
				"          CIFs_Spending_92_12M as string,",
				"          CIFs_Spending_94_12M as string,",
				"          CIFs_Spending_95_12M as string,",
				"          CIFs_Spending_96_12M as string,",
				"          CIFs_Spending_24M as string,",
				"          CIFs_Spending_01_24M as string,",
				"          CIFs_Spending_02_24M as string,",
				"          CIFs_Spending_03_24M as string,",
				"          CIFs_Spending_04_24M as string,",
				"          CIFs_Spending_05_24M as string,",
				"          CIFs_Spending_06_24M as string,",
				"          CIFs_Spending_07_24M as string,",
				"          CIFs_Spending_08_24M as string,",
				"          CIFs_Spending_09_24M as string,",
				"          CIFs_Spending_10_24M as string,",
				"          CIFs_Spending_11_24M as string,",
				"          CIFs_Spending_12_24M as string,",
				"          CIFs_Spending_13_24M as string,",
				"          CIFs_Spending_14_24M as string,",
				"          CIFs_Spending_15_24M as string,",
				"          CIFs_Spending_16_24M as string,",
				"          CIFs_Spending_17_24M as string,",
				"          CIFs_Spending_18_24M as string,",
				"          CIFs_Spending_19_24M as string,",
				"          CIFs_Spending_20_24M as string,",
				"          CIFs_Spending_92_24M as string,",
				"          CIFs_Spending_96_24M as string,",
				"          {_5_PurPower_per_Household_Index} as string,",
				"          {_2_DIOIKHSEIS_Desc_EN} as string,",
				"          {_3_PERIFERIA_Desc_EN} as string,",
				"          R_Rank_prior24M as string,",
				"          F_Rank_prior24M as string,",
				"          M_Rank_prior24M as string,",
				"          rfm_prior24M as string,",
				"          Children_Held2 as string,",
				"          Nomos as string,",
				"          Description_Mixed as string,",
				"          Sem_on_Books as string,",
				"          Invoice_txns_24M_range as string,",
				"          Invoice_txns_01_24M_range as string,",
				"          Invoice_txns_02_24M_range as string,",
				"          Invoice_txns_03_24M_range as string,",
				"          Invoice_txns_04_24M_range as string,",
				"          Invoice_txns_05_24M_range as string,",
				"          Invoice_txns_06_24M_range as string,",
				"          Invoice_txns_07_24M_range as string,",
				"          Invoice_txns_08_24M_range as string,",
				"          Invoice_txns_09_24M_range as string,",
				"          Invoice_txns_10_24M_range as string,",
				"          Invoice_txns_11_24M_range as string,",
				"          Invoice_txns_12_24M_range as string,",
				"          Invoice_txns_13_24M_range as string,",
				"          Invoice_txns_14_24M_range as string,",
				"          Invoice_txns_15_24M_range as string,",
				"          Invoice_txns_16_24M_range as string,",
				"          Invoice_txns_17_24M_range as string,",
				"          Invoice_txns_18_24M_range as string,",
				"          Invoice_txns_19_24M_range as string,",
				"          Invoice_txns_20_24M_range as string,",
				"          Invoice_txns_92_24M_range as string,",
				"          Invoice_txns_96_24M_range as string,",
				"          Invoice_txns_12M_range as string,",
				"          Invoice_txns_01_12M_range as string,",
				"          Invoice_txns_02_12M_range as string,",
				"          Invoice_txns_03_12M_range as string,",
				"          Invoice_txns_04_12M_range as string,",
				"          Invoice_txns_05_12M_range as string,",
				"          Invoice_txns_06_12M_range as string,",
				"          Invoice_txns_07_12M_range as string,",
				"          Invoice_txns_08_12M_range as string,",
				"          Invoice_txns_09_12M_range as string,",
				"          Invoice_txns_10_12M_range as string,",
				"          Invoice_txns_11_12M_range as string,",
				"          Invoice_txns_12_12M_range as string,",
				"          Invoice_txns_13_12M_range as string,",
				"          Invoice_txns_14_12M_range as string,",
				"          Invoice_txns_15_12M_range as string,",
				"          Invoice_txns_16_12M_range as string,",
				"          Invoice_txns_17_12M_range as string,",
				"          Invoice_txns_18_12M_range as string,",
				"          Invoice_txns_19_12M_range as string,",
				"          Invoice_txns_20_12M_range as string,",
				"          Invoice_txns_92_12M_range as string,",
				"          Invoice_txns_96_12M_range as string,",
				"          Points_Redeemed_24M_range as string,",
				"          Points_Earned_24M_range as string,",
				"          Points_Earned_ever_range as string,",
				"          Invoice_Amount_24M_range as string,",
				"          Invoice_SDI_24M as string,",
				"          Invoice_SDI_12M as string,",
				"          CIFs as string,",
				"          Responders as string,",
				"          Responders_Lemesos as string,",
				"          n as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table',",
				"     preferredIntegralType: 'integer',",
				"     preferredFractionalType: 'float',",
				"     booleanFormat: ['1', '0']) ~> ImportTrainingDataset",
				"ImportTrainingDataset select(mapColumn(",
				"          CustomerId,",
				"          Loyalty_PointBalance_Range,",
				"          Gender,",
				"          AgeRange,",
				"          HasEmail,",
				"          {_5_DHMOS_Desc_EN},",
				"          Children_Held,",
				"          RFM,",
				"          F_Rank_24M,",
				"          Activity_History_String_4S,",
				"          CIFs_Spending_14_12M,",
				"          CIFs_Spending_95_12M,",
				"          CIFs_Spending_96_12M,",
				"          CIFs_Spending_07_24M,",
				"          Spending_Customer_Status,",
				"          CIFs_Spending_09_24M,",
				"          Responders_Lemesos",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> SelectTraningColumns",
				"SelectTraningColumns derive({_5_DHMOS_Desc_EN} = case({_5_DHMOS_Desc_EN}=='Pafos - Group H','Group-High RR',\r",
				"          {_5_DHMOS_Desc_EN}=='Pafos - Group G','Group-High RR',\r",
				"          {_5_DHMOS_Desc_EN}=='Pafos - Group C','Group-High RR',\r",
				"          {_5_DHMOS_Desc_EN}=='Pafos - Group B','Group-High RR',\r",
				"          {_5_DHMOS_Desc_EN}=='Pafos - Group E','Group-High RR',\r",
				"          {_5_DHMOS_Desc_EN}=='Pafos - Group F','Group-High RR',\r",
				"          {_5_DHMOS_Desc_EN}=='Pafos - Group J','Group-Low RR',\r",
				"          {_5_DHMOS_Desc_EN}=='Pafos - Group D','Group-Low RR',\r",
				"          {_5_DHMOS_Desc_EN}=='Pafos - Group I','Group-Low RR',\r",
				"          {_5_DHMOS_Desc_EN}=='Pafos - Group A','Group-Low RR',\r",
				"          {_5_DHMOS_Desc_EN}=='Chrysochou','Group-Low RR',\r",
				"          {_5_DHMOS_Desc_EN})) ~> Alter5DHMOS",
				"Alter5DHMOS sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          CustomerId as string,",
				"          Loyalty_PointBalance_Range as string,",
				"          Gender as string,",
				"          AgeRange as string,",
				"          HasEmail as string,",
				"          {_5_DHMOS_Desc_EN} as string,",
				"          Children_Held as string,",
				"          RFM as string,",
				"          F_Rank_24M as string,",
				"          Activity_History_String_4S as string,",
				"          CIFs_Spending_14_12M as string,",
				"          CIFs_Spending_95_12M as string,",
				"          CIFs_Spending_96_12M as string,",
				"          CIFs_Spending_07_24M as string,",
				"          Spending_Customer_Status as string,",
				"          CIFs_Spending_09_24M as string",
				"     ),",
				"     partitionFileNames:['Training_data_transformed.csv'],",
				"     umask: 0777,",
				"     preCommands: [],",
				"     postCommands: [],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     partitionBy('hash', 1)) ~> TrainingTransformed"
			]
		}
	}
}